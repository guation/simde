/* SPDX-License-Identifier: MIT
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use, copy,
 * modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
 * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 * Copyright:
 *   2021      Evan Nemerson <evan@nemerson.com>
 *   2024      Guation <guation@guation.cn>
 */

#define SIMDE_TEST_X86_AVX512_INSN expand

#include <test/x86/avx512/test-avx512.h>
#include <simde/x86/avx512/set.h>
#include <simde/x86/avx512/expand.h>

static int
test_simde_mm256_mask_expand_epi32 (SIMDE_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const int32_t src[8];
    const simde__mmask8 k;
    const int32_t a[8];
    const int32_t r[8];
  } test_vec[] = {
    { { -INT32_C(  1807377691), -INT32_C(  1704232880), -INT32_C(  1778826755), -INT32_C(    21052482),  INT32_C(   806970891),  INT32_C(   545047790),  INT32_C(   398939030), -INT32_C(  1548893250) },
      UINT8_C( 93),
      {  INT32_C(  1806579955), -INT32_C(   462927709),  INT32_C(    94567746),  INT32_C(   571515067),  INT32_C(  2098217401),  INT32_C(   269693117), -INT32_C(  1160827913), -INT32_C(   887655720) },
      {  INT32_C(  1806579955), -INT32_C(  1704232880), -INT32_C(   462927709),  INT32_C(    94567746),  INT32_C(   571515067),  INT32_C(   545047790),  INT32_C(  2098217401), -INT32_C(  1548893250) } },
    { {  INT32_C(  1295500714),  INT32_C(  1345429262),  INT32_C(  1482019997),  INT32_C(   779773556),  INT32_C(  1688963751), -INT32_C(  1317748806), -INT32_C(  1033157654),  INT32_C(  1619952566) },
      UINT8_C( 72),
      {  INT32_C(  1683402437), -INT32_C(  1291737377),  INT32_C(  1646811900),  INT32_C(  1594447572), -INT32_C(  1072075519),  INT32_C(   631950305), -INT32_C(  1176801994), -INT32_C(  1073595397) },
      {  INT32_C(  1295500714),  INT32_C(  1345429262),  INT32_C(  1482019997),  INT32_C(  1683402437),  INT32_C(  1688963751), -INT32_C(  1317748806), -INT32_C(  1291737377),  INT32_C(  1619952566) } },
    { { -INT32_C(   920364823), -INT32_C(    75749633),  INT32_C(  1415423104), -INT32_C(    55351558), -INT32_C(  1262694957), -INT32_C(   824612968), -INT32_C(   813124396), -INT32_C(   644904208) },
      UINT8_C(226),
      { -INT32_C(   639524173), -INT32_C(  1017521121), -INT32_C(  1614893511),  INT32_C(   779270753), -INT32_C(   574216330), -INT32_C(  1246653184), -INT32_C(  1482325987), -INT32_C(  1014399473) },
      { -INT32_C(   920364823), -INT32_C(   639524173),  INT32_C(  1415423104), -INT32_C(    55351558), -INT32_C(  1262694957), -INT32_C(  1017521121), -INT32_C(  1614893511),  INT32_C(   779270753) } },
    { {  INT32_C(  1083992865), -INT32_C(  2130446777),  INT32_C(    86032804), -INT32_C(   231435397), -INT32_C(  1160774982), -INT32_C(  1401978481),  INT32_C(   290657281), -INT32_C(  1261118061) },
      UINT8_C( 72),
      {  INT32_C(  1720710256), -INT32_C(  1190522633), -INT32_C(  1003220943),  INT32_C(  1048454724),  INT32_C(  2010003702), -INT32_C(  1132954968), -INT32_C(  1420850738), -INT32_C(   822934691) },
      {  INT32_C(  1083992865), -INT32_C(  2130446777),  INT32_C(    86032804),  INT32_C(  1720710256), -INT32_C(  1160774982), -INT32_C(  1401978481), -INT32_C(  1190522633), -INT32_C(  1261118061) } },
    { { -INT32_C(   281771273), -INT32_C(   995606637), -INT32_C(  1819747249), -INT32_C(   103741949), -INT32_C(   428826818), -INT32_C(   391911398), -INT32_C(   812387726), -INT32_C(   308443402) },
      UINT8_C(  8),
      {  INT32_C(   295427282),  INT32_C(  1633705860), -INT32_C(   312151065),  INT32_C(  1680629188), -INT32_C(  1250028851), -INT32_C(  1473812811),  INT32_C(  2141124601),  INT32_C(  1720159124) },
      { -INT32_C(   281771273), -INT32_C(   995606637), -INT32_C(  1819747249),  INT32_C(   295427282), -INT32_C(   428826818), -INT32_C(   391911398), -INT32_C(   812387726), -INT32_C(   308443402) } },
    { { -INT32_C(   327736472),  INT32_C(  1783486338), -INT32_C(  1890078262), -INT32_C(   604798194),  INT32_C(  1267822998), -INT32_C(   789333801),  INT32_C(  1146065327), -INT32_C(  2052401635) },
      UINT8_C(249),
      { -INT32_C(   109285086),  INT32_C(  1891952319), -INT32_C(  1048620227), -INT32_C(  1219012026), -INT32_C(  1534156053),  INT32_C(   659775126), -INT32_C(  2092656723),  INT32_C(  1685965122) },
      { -INT32_C(   109285086),  INT32_C(  1783486338), -INT32_C(  1890078262),  INT32_C(  1891952319), -INT32_C(  1048620227), -INT32_C(  1219012026), -INT32_C(  1534156053),  INT32_C(   659775126) } },
    { { -INT32_C(    94504645),  INT32_C(   476717535), -INT32_C(  1159861900),  INT32_C(   795948100),  INT32_C(  1842610135),  INT32_C(   177481565),  INT32_C(     9361854), -INT32_C(   580645982) },
      UINT8_C(  4),
      { -INT32_C(   471607358),  INT32_C(   727252802),  INT32_C(   292491997), -INT32_C(  2081906812), -INT32_C(  1713285774), -INT32_C(  1017582614), -INT32_C(  2073732999),  INT32_C(  2139636669) },
      { -INT32_C(    94504645),  INT32_C(   476717535), -INT32_C(   471607358),  INT32_C(   795948100),  INT32_C(  1842610135),  INT32_C(   177481565),  INT32_C(     9361854), -INT32_C(   580645982) } },
    { {  INT32_C(  1549953818),  INT32_C(  1216920171),  INT32_C(  1364850637),  INT32_C(   164905622), -INT32_C(  2120043113),  INT32_C(   440728225),  INT32_C(   278899283),  INT32_C(   126822381) },
      UINT8_C(147),
      { -INT32_C(  1392614159), -INT32_C(   478591252), -INT32_C(   512046433),  INT32_C(  1417249694),  INT32_C(   552991269), -INT32_C(   378335425), -INT32_C(   690584658),  INT32_C(    57269522) },
      { -INT32_C(  1392614159), -INT32_C(   478591252),  INT32_C(  1364850637),  INT32_C(   164905622), -INT32_C(   512046433),  INT32_C(   440728225),  INT32_C(   278899283),  INT32_C(  1417249694) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    simde__m256i src = simde_x_mm256_loadu_epi32(test_vec[i].src);
    simde__mmask8 k = test_vec[i].k;
    simde__m256i a = simde_x_mm256_loadu_epi32(test_vec[i].a);
    simde__m256i r = simde_mm256_mask_expand_epi32(src, k, a);
    simde_test_x86_assert_equal_i32x8(r, simde_x_mm256_loadu_epi32(test_vec[i].r));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    simde__m256i src = simde_test_x86_random_i32x8();
    simde__mmask8 k = simde_test_x86_random_mmask8();
    simde__m256i a = simde_test_x86_random_i32x8();
    simde__m256i r = simde_mm256_mask_expand_epi32(src, k, a);

    simde_test_x86_write_i32x8(2, src, SIMDE_TEST_VEC_POS_FIRST);
    simde_test_x86_write_mmask8(2, k, SIMDE_TEST_VEC_POS_MIDDLE);
    simde_test_x86_write_i32x8(2, a, SIMDE_TEST_VEC_POS_MIDDLE);
    simde_test_x86_write_i32x8(2, r, SIMDE_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_simde_mm256_maskz_expand_epi32 (SIMDE_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const simde__mmask8 k;
    const int32_t a[8];
    const int32_t r[8];
  } test_vec[] = {
    { UINT8_C(166),
      {  INT32_C(   153778204), -INT32_C(   592711181),  INT32_C(   298932777),  INT32_C(   778264931), -INT32_C(   278534587),  INT32_C(  2090262096), -INT32_C(   140643639),  INT32_C(   949866012) },
      {  INT32_C(           0),  INT32_C(   153778204), -INT32_C(   592711181),  INT32_C(           0),  INT32_C(           0),  INT32_C(   298932777),  INT32_C(           0),  INT32_C(   778264931) } },
    { UINT8_C( 70),
      { -INT32_C(  1187429945),  INT32_C(  1205999085),  INT32_C(  1219228646),  INT32_C(  1015929174),  INT32_C(   495746367),  INT32_C(    98961427),  INT32_C(  1948442277),  INT32_C(  1136286331) },
      {  INT32_C(           0), -INT32_C(  1187429945),  INT32_C(  1205999085),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1219228646),  INT32_C(           0) } },
    { UINT8_C(156),
      {  INT32_C(   160038132), -INT32_C(   772747042),  INT32_C(  1428633723),  INT32_C(  1117021381), -INT32_C(   111758864),  INT32_C(  1973312407), -INT32_C(   655289731), -INT32_C(  1049348915) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(   160038132), -INT32_C(   772747042),  INT32_C(  1428633723),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1117021381) } },
    { UINT8_C( 48),
      { -INT32_C(   854668547), -INT32_C(   230039622),  INT32_C(  1790483974), -INT32_C(   480511438), -INT32_C(  1401269168),  INT32_C(    86634738),  INT32_C(   366084577),  INT32_C(  1917162357) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(   854668547), -INT32_C(   230039622),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C( 93),
      {  INT32_C(   840450131),  INT32_C(   657984137), -INT32_C(  1118198846),  INT32_C(  1376599294), -INT32_C(  1505445450), -INT32_C(   460895773), -INT32_C(  1369793509),  INT32_C(   873254113) },
      {  INT32_C(   840450131),  INT32_C(           0),  INT32_C(   657984137), -INT32_C(  1118198846),  INT32_C(  1376599294),  INT32_C(           0), -INT32_C(  1505445450),  INT32_C(           0) } },
    { UINT8_C( 12),
      {  INT32_C(   781542948),  INT32_C(  1123138719),  INT32_C(  1363193365),  INT32_C(  1963496123),  INT32_C(   542682838), -INT32_C(   767869898),  INT32_C(  1672800918),  INT32_C(   443541750) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(   781542948),  INT32_C(  1123138719),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C( 79),
      { -INT32_C(  1041348603), -INT32_C(   405327815),  INT32_C(    44247152), -INT32_C(   539486160), -INT32_C(  1407846288),  INT32_C(   507766580), -INT32_C(  2079021413),  INT32_C(   450047509) },
      { -INT32_C(  1041348603), -INT32_C(   405327815),  INT32_C(    44247152), -INT32_C(   539486160),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1407846288),  INT32_C(           0) } },
    { UINT8_C(118),
      { -INT32_C(   240067391), -INT32_C(   614361165),  INT32_C(  1376543546),  INT32_C(   885189435), -INT32_C(   412586240),  INT32_C(  1485014706), -INT32_C(   932378726), -INT32_C(  1690400550) },
      {  INT32_C(           0), -INT32_C(   240067391), -INT32_C(   614361165),  INT32_C(           0),  INT32_C(  1376543546),  INT32_C(   885189435), -INT32_C(   412586240),  INT32_C(           0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    simde__mmask8 k = test_vec[i].k;
    simde__m256i a = simde_x_mm256_loadu_epi32(test_vec[i].a);
    simde__m256i r = simde_mm256_maskz_expand_epi32(k, a);
    simde_test_x86_assert_equal_i32x8(r, simde_x_mm256_loadu_epi32(test_vec[i].r));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    simde__mmask8 k = simde_test_x86_random_mmask8();
    simde__m256i a = simde_test_x86_random_i32x8();
    simde__m256i r = simde_mm256_maskz_expand_epi32(k, a);

    simde_test_x86_write_mmask8(2, k, SIMDE_TEST_VEC_POS_FIRST);
    simde_test_x86_write_i32x8(2, a, SIMDE_TEST_VEC_POS_MIDDLE);
    simde_test_x86_write_i32x8(2, r, SIMDE_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_simde_mm512_mask_expand_epi32 (SIMDE_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const int32_t src[16];
    const simde__mmask16 k;
    const int32_t a[16];
    const int32_t r[16];
  } test_vec[] = {
    { { -INT32_C(  1878626479),  INT32_C(  1557005513), -INT32_C(  1183779239),  INT32_C(   555975897),  INT32_C(    19948721),  INT32_C(   648743959),  INT32_C(  1545666214), -INT32_C(  1908839620),
        -INT32_C(  1558298662), -INT32_C(  1660949437), -INT32_C(  1135185949), -INT32_C(  1512211981), -INT32_C(   173666594), -INT32_C(  1055174118), -INT32_C(  1944241072), -INT32_C(  2112203097) },
      UINT16_C(14741),
      {  INT32_C(   623237157), -INT32_C(   879490955), -INT32_C(  1572566844), -INT32_C(   743431635),  INT32_C(   858114583), -INT32_C(  1469090421),  INT32_C(   486413826), -INT32_C(  1101687912),
        -INT32_C(   505185428),  INT32_C(  1219262339),  INT32_C(   753594623),  INT32_C(   704682515), -INT32_C(   262331036), -INT32_C(  1650930533),  INT32_C(  2075760611), -INT32_C(  1774645462) },
      {  INT32_C(   623237157),  INT32_C(  1557005513), -INT32_C(   879490955),  INT32_C(   555975897), -INT32_C(  1572566844),  INT32_C(   648743959),  INT32_C(  1545666214), -INT32_C(   743431635),
         INT32_C(   858114583), -INT32_C(  1660949437), -INT32_C(  1135185949), -INT32_C(  1469090421),  INT32_C(   486413826), -INT32_C(  1101687912), -INT32_C(  1944241072), -INT32_C(  2112203097) } },
    { {  INT32_C(   225909898), -INT32_C(  1823136876),  INT32_C(   666910484),  INT32_C(  1045545177), -INT32_C(  2144423963),  INT32_C(  1579009659), -INT32_C(  1998923939),  INT32_C(  1881019366),
        -INT32_C(   998402512), -INT32_C(   849882183), -INT32_C(   319547630), -INT32_C(  1121302825),  INT32_C(  1883068661),  INT32_C(  2093964062),  INT32_C(   402958642), -INT32_C(   326622532) },
      UINT16_C( 1464),
      {  INT32_C(   148402864),  INT32_C(   874507071),  INT32_C(    24836055), -INT32_C(   245796940), -INT32_C(  1370720289), -INT32_C(   145260813),  INT32_C(   505025686), -INT32_C(  1322987008),
        -INT32_C(  2068186044), -INT32_C(  1095182105), -INT32_C(  2084621617), -INT32_C(  2139809631), -INT32_C(  2094022256), -INT32_C(   696547776), -INT32_C(  1678404198), -INT32_C(  1404298905) },
      {  INT32_C(   225909898), -INT32_C(  1823136876),  INT32_C(   666910484),  INT32_C(   148402864),  INT32_C(   874507071),  INT32_C(    24836055), -INT32_C(  1998923939), -INT32_C(   245796940),
        -INT32_C(  1370720289), -INT32_C(   849882183), -INT32_C(   145260813), -INT32_C(  1121302825),  INT32_C(  1883068661),  INT32_C(  2093964062),  INT32_C(   402958642), -INT32_C(   326622532) } },
    { { -INT32_C(    47184619), -INT32_C(  1380194083), -INT32_C(  1154450662),  INT32_C(   591111571), -INT32_C(  1482200473), -INT32_C(  1954733327),  INT32_C(   505836215), -INT32_C(  1580567925),
         INT32_C(  1436482167), -INT32_C(    66954782),  INT32_C(  1756836564),  INT32_C(  1066136536),  INT32_C(  1323709021),  INT32_C(   198861652),  INT32_C(  1630142678), -INT32_C(   368905101) },
      UINT16_C(41199),
      {  INT32_C(  1106956607), -INT32_C(  2055942450), -INT32_C(  1032303562),  INT32_C(  1911871115), -INT32_C(    19642076),  INT32_C(  2130684500),  INT32_C(   242446860), -INT32_C(  1666227620),
         INT32_C(    31303987), -INT32_C(  1366863497),  INT32_C(   678494109), -INT32_C(    90610475),  INT32_C(    49835693),  INT32_C(   612431640), -INT32_C(   969673879), -INT32_C(  1990008235) },
      {  INT32_C(  1106956607), -INT32_C(  2055942450), -INT32_C(  1032303562),  INT32_C(  1911871115), -INT32_C(  1482200473), -INT32_C(    19642076),  INT32_C(  2130684500),  INT32_C(   242446860),
         INT32_C(  1436482167), -INT32_C(    66954782),  INT32_C(  1756836564),  INT32_C(  1066136536),  INT32_C(  1323709021), -INT32_C(  1666227620),  INT32_C(  1630142678),  INT32_C(    31303987) } },
    { {  INT32_C(    42614667),  INT32_C(   783290769), -INT32_C(   430497775),  INT32_C(   853602437),  INT32_C(  1999952222),  INT32_C(   983283152), -INT32_C(    33501528),  INT32_C(   998728368),
         INT32_C(   842928545),  INT32_C(   878833187), -INT32_C(  1810188273),  INT32_C(   130481064), -INT32_C(  1535181868),  INT32_C(  1490950576), -INT32_C(  1739137304), -INT32_C(   489366208) },
      UINT16_C( 4847),
      {  INT32_C(  1962938900),  INT32_C(  1613565766),  INT32_C(  1784403619),  INT32_C(  1533358045), -INT32_C(  1301015084), -INT32_C(   997106579), -INT32_C(   912141835), -INT32_C(   925134669),
        -INT32_C(   398599262), -INT32_C(  1907790869),  INT32_C(   519611457), -INT32_C(  1468441132), -INT32_C(   530911886),  INT32_C(  1067772746),  INT32_C(  1879590333),  INT32_C(  2016994262) },
      {  INT32_C(  1962938900),  INT32_C(  1613565766),  INT32_C(  1784403619),  INT32_C(  1533358045),  INT32_C(  1999952222), -INT32_C(  1301015084), -INT32_C(   997106579), -INT32_C(   912141835),
         INT32_C(   842928545), -INT32_C(   925134669), -INT32_C(  1810188273),  INT32_C(   130481064), -INT32_C(   398599262),  INT32_C(  1490950576), -INT32_C(  1739137304), -INT32_C(   489366208) } },
    { { -INT32_C(  1453230402),  INT32_C(   574139105),  INT32_C(   574632014),  INT32_C(    13285774), -INT32_C(   253745754), -INT32_C(   852524016), -INT32_C(  1606535222), -INT32_C(   652708326),
        -INT32_C(   847087124),  INT32_C(  1928313379),  INT32_C(  2039754731), -INT32_C(  1887871000), -INT32_C(  1803593084), -INT32_C(  1469927458),  INT32_C(    21536998),  INT32_C(    64643350) },
      UINT16_C(23770),
      { -INT32_C(  1072169264),  INT32_C(    82772592), -INT32_C(   194783109), -INT32_C(   431036569), -INT32_C(   560648836),  INT32_C(   511605973),  INT32_C(  1467978877),  INT32_C(  1756584343),
        -INT32_C(   953628073),  INT32_C(  1204557772),  INT32_C(  1446785007), -INT32_C(  1824683497), -INT32_C(  1921920329), -INT32_C(   877924530),  INT32_C(   455223939), -INT32_C(   612116861) },
      { -INT32_C(  1453230402), -INT32_C(  1072169264),  INT32_C(   574632014),  INT32_C(    82772592), -INT32_C(   194783109), -INT32_C(   852524016), -INT32_C(   431036569), -INT32_C(   560648836),
        -INT32_C(   847087124),  INT32_C(  1928313379),  INT32_C(   511605973),  INT32_C(  1467978877),  INT32_C(  1756584343), -INT32_C(  1469927458), -INT32_C(   953628073),  INT32_C(    64643350) } },
    { {  INT32_C(  1839377312), -INT32_C(  1296798014), -INT32_C(  1257705314),  INT32_C(   843597179),  INT32_C(  1723840792),  INT32_C(   724724392),  INT32_C(   407262356), -INT32_C(   873215702),
         INT32_C(   926455156), -INT32_C(  1561727996),  INT32_C(  1482158557),  INT32_C(  1334484791),  INT32_C(    11881048),  INT32_C(  1227614132),  INT32_C(  1717662268), -INT32_C(  1338944453) },
      UINT16_C(27113),
      { -INT32_C(   799609369), -INT32_C(   423545969),  INT32_C(   361101451), -INT32_C(    44049081),  INT32_C(   165942493), -INT32_C(  1099227043), -INT32_C(  1206733177),  INT32_C(  1294138214),
         INT32_C(  2015197417),  INT32_C(   912252843),  INT32_C(   525067479), -INT32_C(  1625510974),  INT32_C(   480772287), -INT32_C(  1462099167),  INT32_C(  1080093914), -INT32_C(   795966745) },
      { -INT32_C(   799609369), -INT32_C(  1296798014), -INT32_C(  1257705314), -INT32_C(   423545969),  INT32_C(  1723840792),  INT32_C(   361101451), -INT32_C(    44049081),  INT32_C(   165942493),
        -INT32_C(  1099227043), -INT32_C(  1561727996),  INT32_C(  1482158557), -INT32_C(  1206733177),  INT32_C(    11881048),  INT32_C(  1294138214),  INT32_C(  2015197417), -INT32_C(  1338944453) } },
    { { -INT32_C(  1521898502),  INT32_C(  1658562698),  INT32_C(  1317087116), -INT32_C(  1846633006), -INT32_C(  1095919971), -INT32_C(  1805219910),  INT32_C(  1523894131),  INT32_C(  1143693897),
        -INT32_C(  1729530866), -INT32_C(  1459960548), -INT32_C(  1091077140), -INT32_C(  1236277992),  INT32_C(   896859259), -INT32_C(   154543229), -INT32_C(   347038046),  INT32_C(   237992704) },
      UINT16_C( 6639),
      { -INT32_C(  1579283545), -INT32_C(  1424110924), -INT32_C(   678414968),  INT32_C(  1624443883),  INT32_C(   171660865), -INT32_C(  1666654900), -INT32_C(   132601400),  INT32_C(  1578174391),
        -INT32_C(   956240109),  INT32_C(  1097997753),  INT32_C(  1041760850),  INT32_C(  1319037709), -INT32_C(  1923491519),  INT32_C(  2116616630),  INT32_C(  1651917226),  INT32_C(  1556121417) },
      { -INT32_C(  1579283545), -INT32_C(  1424110924), -INT32_C(   678414968),  INT32_C(  1624443883), -INT32_C(  1095919971),  INT32_C(   171660865), -INT32_C(  1666654900), -INT32_C(   132601400),
         INT32_C(  1578174391), -INT32_C(  1459960548), -INT32_C(  1091077140), -INT32_C(   956240109),  INT32_C(  1097997753), -INT32_C(   154543229), -INT32_C(   347038046),  INT32_C(   237992704) } },
    { {  INT32_C(   790872182),  INT32_C(   812684765), -INT32_C(  1536259945), -INT32_C(  1259139981), -INT32_C(  1690219291), -INT32_C(   132551859), -INT32_C(   178614100), -INT32_C(  1907287529),
        -INT32_C(  1195543333), -INT32_C(  1595396599),  INT32_C(   709187254),  INT32_C(  1205745762), -INT32_C(   773709692),  INT32_C(   935984267), -INT32_C(  1557322868),  INT32_C(   422673982) },
      UINT16_C(61427),
      { -INT32_C(  1172439855), -INT32_C(   502213731), -INT32_C(   602246147), -INT32_C(  1644388678),  INT32_C(   966362991), -INT32_C(   346282562), -INT32_C(    93676856), -INT32_C(  2048303693),
        -INT32_C(   163641767), -INT32_C(   673689639),  INT32_C(  2108945090),  INT32_C(     1748880), -INT32_C(   197545162), -INT32_C(  1595894312), -INT32_C(   476427728),  INT32_C(     6849447) },
      { -INT32_C(  1172439855), -INT32_C(   502213731), -INT32_C(  1536259945), -INT32_C(  1259139981), -INT32_C(   602246147), -INT32_C(  1644388678),  INT32_C(   966362991), -INT32_C(   346282562),
        -INT32_C(    93676856), -INT32_C(  2048303693), -INT32_C(   163641767), -INT32_C(   673689639), -INT32_C(   773709692),  INT32_C(  2108945090),  INT32_C(     1748880), -INT32_C(   197545162) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    simde__m512i src = simde_mm512_loadu_epi32(test_vec[i].src);
    simde__mmask16 k = test_vec[i].k;
    simde__m512i a = simde_mm512_loadu_epi32(test_vec[i].a);
    simde__m512i r = simde_mm512_mask_expand_epi32(src, k, a);
    simde_test_x86_assert_equal_i32x16(r, simde_mm512_loadu_epi32(test_vec[i].r));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    simde__m512i src = simde_test_x86_random_i32x16();
    simde__mmask16 k = simde_test_x86_random_mmask16();
    simde__m512i a = simde_test_x86_random_i32x16();
    simde__m512i r = simde_mm512_mask_expand_epi32(src, k, a);

    simde_test_x86_write_i32x16(2, src, SIMDE_TEST_VEC_POS_FIRST);
    simde_test_x86_write_mmask16(2, k, SIMDE_TEST_VEC_POS_MIDDLE);
    simde_test_x86_write_i32x16(2, a, SIMDE_TEST_VEC_POS_MIDDLE);
    simde_test_x86_write_i32x16(2, r, SIMDE_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_simde_mm512_maskz_expand_epi32 (SIMDE_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const simde__mmask16 k;
    const int32_t a[16];
    const int32_t r[16];
  } test_vec[] = {
    { UINT16_C(23846),
      {  INT32_C(  1762788019),  INT32_C(  1449244418), -INT32_C(  1514022019), -INT32_C(  1957824771),  INT32_C(  1845405301),  INT32_C(  1024809038), -INT32_C(   760237901),  INT32_C(  1479529892),
        -INT32_C(   641646121),  INT32_C(  1982800632), -INT32_C(    98832131),  INT32_C(  1552247270),  INT32_C(  1590264847), -INT32_C(  1885610276),  INT32_C(   845236878), -INT32_C(   141914081) },
      {  INT32_C(           0),  INT32_C(  1762788019),  INT32_C(  1449244418),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1514022019),  INT32_C(           0),  INT32_C(           0),
        -INT32_C(  1957824771),  INT32_C(           0),  INT32_C(  1845405301),  INT32_C(  1024809038), -INT32_C(   760237901),  INT32_C(           0),  INT32_C(  1479529892),  INT32_C(           0) } },
    { UINT16_C(19410),
      {  INT32_C(     7195344),  INT32_C(  1559259712), -INT32_C(   356133019), -INT32_C(    59845581), -INT32_C(   824554702),  INT32_C(  1008232666),  INT32_C(   634140826), -INT32_C(     9396689),
        -INT32_C(  1442849175), -INT32_C(  1392119736), -INT32_C(    90649913), -INT32_C(   772405601),  INT32_C(   748671057), -INT32_C(   764889032),  INT32_C(   536294640),  INT32_C(  1008625875) },
      {  INT32_C(           0),  INT32_C(     7195344),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1559259712),  INT32_C(           0), -INT32_C(   356133019), -INT32_C(    59845581),
        -INT32_C(   824554702),  INT32_C(  1008232666),  INT32_C(           0),  INT32_C(   634140826),  INT32_C(           0),  INT32_C(           0), -INT32_C(     9396689),  INT32_C(           0) } },
    { UINT16_C( 7750),
      { -INT32_C(   351367451), -INT32_C(   726280900), -INT32_C(   975547185), -INT32_C(   980079578), -INT32_C(  1065497256), -INT32_C(  1745588833), -INT32_C(  1409300596), -INT32_C(   372685565),
         INT32_C(   265607123),  INT32_C(  2078509484),  INT32_C(    71352030),  INT32_C(  1120523754),  INT32_C(  1090668450),  INT32_C(  1104737972), -INT32_C(  1041442882), -INT32_C(   257247972) },
      {  INT32_C(           0), -INT32_C(   351367451), -INT32_C(   726280900),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(   975547185),  INT32_C(           0),
         INT32_C(           0), -INT32_C(   980079578), -INT32_C(  1065497256), -INT32_C(  1745588833), -INT32_C(  1409300596),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(32396),
      { -INT32_C(   486000385), -INT32_C(   207493453), -INT32_C(  1278702614), -INT32_C(   805672243), -INT32_C(  2067419221), -INT32_C(   597982224), -INT32_C(   275679163),  INT32_C(  1735269736),
         INT32_C(   139097685),  INT32_C(  1190914908),  INT32_C(  1140441974), -INT32_C(   669846483), -INT32_C(  1822631773), -INT32_C(  1603291045), -INT32_C(  1735393232),  INT32_C(  1929379357) },
      {  INT32_C(           0),  INT32_C(           0), -INT32_C(   486000385), -INT32_C(   207493453),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1278702614),
         INT32_C(           0), -INT32_C(   805672243), -INT32_C(  2067419221), -INT32_C(   597982224), -INT32_C(   275679163),  INT32_C(  1735269736),  INT32_C(   139097685),  INT32_C(           0) } },
    { UINT16_C(19060),
      {  INT32_C(  1966461050),  INT32_C(   255372310),  INT32_C(    33777135), -INT32_C(  1696946627), -INT32_C(  1471007431),  INT32_C(  1722319574),  INT32_C(   426034458), -INT32_C(  1318856649),
        -INT32_C(  1104766552),  INT32_C(   885874245),  INT32_C(    20369859), -INT32_C(  1315237769),  INT32_C(   475655494), -INT32_C(  1987968401), -INT32_C(     6101305),  INT32_C(  1722812094) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(  1966461050),  INT32_C(           0),  INT32_C(   255372310),  INT32_C(    33777135), -INT32_C(  1696946627),  INT32_C(           0),
         INT32_C(           0), -INT32_C(  1471007431),  INT32_C(           0),  INT32_C(  1722319574),  INT32_C(           0),  INT32_C(           0),  INT32_C(   426034458),  INT32_C(           0) } },
    { UINT16_C(55199),
      { -INT32_C(   248126428),  INT32_C(  1338177816), -INT32_C(  1788921094),  INT32_C(  1149412843),  INT32_C(  1128722881),  INT32_C(   472452730), -INT32_C(  1121786099),  INT32_C(  1905574221),
        -INT32_C(  1100756315), -INT32_C(  1123211837),  INT32_C(  1246915679), -INT32_C(   745548782),  INT32_C(  1058526661), -INT32_C(   262455069),  INT32_C(  1974369832), -INT32_C(   437829057) },
      { -INT32_C(   248126428),  INT32_C(  1338177816), -INT32_C(  1788921094),  INT32_C(  1149412843),  INT32_C(  1128722881),  INT32_C(           0),  INT32_C(           0),  INT32_C(   472452730),
        -INT32_C(  1121786099),  INT32_C(  1905574221), -INT32_C(  1100756315),  INT32_C(           0), -INT32_C(  1123211837),  INT32_C(           0),  INT32_C(  1246915679), -INT32_C(   745548782) } },
    { UINT16_C(18956),
      { -INT32_C(  1334849629), -INT32_C(   568537204), -INT32_C(  1464717799),  INT32_C(   427718402),  INT32_C(   307847606),  INT32_C(     9470290), -INT32_C(   566046729),  INT32_C(  1462259636),
        -INT32_C(  1425565922), -INT32_C(  2138495898),  INT32_C(  1411923026),  INT32_C(  1785570995),  INT32_C(  1518126856),  INT32_C(  1062865992), -INT32_C(  1877107493),  INT32_C(   182928875) },
      {  INT32_C(           0),  INT32_C(           0), -INT32_C(  1334849629), -INT32_C(   568537204),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),
         INT32_C(           0), -INT32_C(  1464717799),  INT32_C(           0),  INT32_C(   427718402),  INT32_C(           0),  INT32_C(           0),  INT32_C(   307847606),  INT32_C(           0) } },
    { UINT16_C(61405),
      {  INT32_C(  1041449909), -INT32_C(   327522877),  INT32_C(   663891642),  INT32_C(   351181464),  INT32_C(  1310734324), -INT32_C(  1796473994),  INT32_C(  1943656075), -INT32_C(  1788692768),
        -INT32_C(  1110149638), -INT32_C(  1800843558),  INT32_C(   347880572), -INT32_C(   886527274),  INT32_C(  1478052065), -INT32_C(   806615996), -INT32_C(  1153251877),  INT32_C(  1985062012) },
      {  INT32_C(  1041449909),  INT32_C(           0), -INT32_C(   327522877),  INT32_C(   663891642),  INT32_C(   351181464),  INT32_C(           0),  INT32_C(  1310734324), -INT32_C(  1796473994),
         INT32_C(  1943656075), -INT32_C(  1788692768), -INT32_C(  1110149638), -INT32_C(  1800843558),  INT32_C(           0),  INT32_C(   347880572), -INT32_C(   886527274),  INT32_C(  1478052065) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    simde__mmask16 k = test_vec[i].k;
    simde__m512i a = simde_mm512_loadu_epi32(test_vec[i].a);
    simde__m512i r = simde_mm512_maskz_expand_epi32(k, a);
    simde_test_x86_assert_equal_i32x16(r, simde_mm512_loadu_epi32(test_vec[i].r));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    simde__mmask16 k = simde_test_x86_random_mmask16();
    simde__m512i a = simde_test_x86_random_i32x16();
    simde__m512i r = simde_mm512_maskz_expand_epi32(k, a);

    simde_test_x86_write_mmask16(2, k, SIMDE_TEST_VEC_POS_FIRST);
    simde_test_x86_write_i32x16(2, a, SIMDE_TEST_VEC_POS_MIDDLE);
    simde_test_x86_write_i32x16(2, r, SIMDE_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

SIMDE_TEST_FUNC_LIST_BEGIN
  SIMDE_TEST_FUNC_LIST_ENTRY(mm256_mask_expand_epi32)
  SIMDE_TEST_FUNC_LIST_ENTRY(mm256_maskz_expand_epi32)
  SIMDE_TEST_FUNC_LIST_ENTRY(mm512_mask_expand_epi32)
  SIMDE_TEST_FUNC_LIST_ENTRY(mm512_maskz_expand_epi32)
SIMDE_TEST_FUNC_LIST_END

#include <test/x86/avx512/test-avx512-footer.h>
