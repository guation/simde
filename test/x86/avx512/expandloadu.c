/* SPDX-License-Identifier: MIT
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use, copy,
 * modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
 * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 * Copyright:
 *   2024      Guation <guation@guation.cn>
 */

#define SIMDE_TEST_X86_AVX512_INSN expandloadu

#include <test/x86/avx512/test-avx512.h>
#include <simde/x86/avx512/expandloadu.h>

static int
test_simde_mm512_mask_expandloadu_epi32 (SIMDE_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const int32_t src[16];
    const simde__mmask16 k;
    const int32_t mem_addr[16];
    const int32_t r[16];
  } test_vec[] = {
    { { -INT32_C(  1208314204), -INT32_C(   979810621),  INT32_C(  1219486111),  INT32_C(  1780936777),  INT32_C(   252188611), -INT32_C(  1128993606),  INT32_C(  1824752756), -INT32_C(  1514299904),
        -INT32_C(   128141516), -INT32_C(  1665272323),  INT32_C(   551906518),  INT32_C(   529140572), -INT32_C(   600861918), -INT32_C(   208084097),  INT32_C(  1751079783),  INT32_C(   772611322) },
      UINT16_C(27091),
      { -INT32_C(   480325594),  INT32_C(  1380922477), -INT32_C(   547509420), -INT32_C(    93159477), -INT32_C(   203558565),  INT32_C(  1129202916), -INT32_C(  1184937812), -INT32_C(  1658703241),
         INT32_C(  1870757890),  INT32_C(   163696821),  INT32_C(  1206394492), -INT32_C(   129934691),  INT32_C(   803937867),  INT32_C(   259144290), -INT32_C(   104279678),  INT32_C(   110619395) },
      { -INT32_C(   480325594),  INT32_C(  1380922477),  INT32_C(  1219486111),  INT32_C(  1780936777), -INT32_C(   547509420), -INT32_C(  1128993606), -INT32_C(    93159477), -INT32_C(   203558565),
         INT32_C(  1129202916), -INT32_C(  1665272323),  INT32_C(   551906518), -INT32_C(  1184937812), -INT32_C(   600861918), -INT32_C(  1658703241),  INT32_C(  1870757890),  INT32_C(   772611322) } },
    { {  INT32_C(   544544875),  INT32_C(  1680488424), -INT32_C(   206892459), -INT32_C(  1192498067),  INT32_C(  1843975946), -INT32_C(  1820567023),  INT32_C(   797787180), -INT32_C(  1691016145),
         INT32_C(   616278844),  INT32_C(   931784162),  INT32_C(  1697264888),  INT32_C(   723326497), -INT32_C(    23591443), -INT32_C(  1936649120), -INT32_C(  2001002919),  INT32_C(  2116284738) },
      UINT16_C(57244),
      {  INT32_C(   751074979), -INT32_C(   530531147),  INT32_C(  1073119521),  INT32_C(  1162142637),  INT32_C(  1918543073), -INT32_C(   325995728),  INT32_C(  1608373051), -INT32_C(   180455086),
        -INT32_C(  1407122697), -INT32_C(   527662657), -INT32_C(  1340112381),  INT32_C(  1190487141),  INT32_C(   968445704),  INT32_C(  1042631170),  INT32_C(  1872560669),  INT32_C(  1919212411) },
      {  INT32_C(   544544875),  INT32_C(  1680488424),  INT32_C(   751074979), -INT32_C(   530531147),  INT32_C(  1073119521), -INT32_C(  1820567023),  INT32_C(   797787180),  INT32_C(  1162142637),
         INT32_C(  1918543073), -INT32_C(   325995728),  INT32_C(  1608373051), -INT32_C(   180455086), -INT32_C(  1407122697), -INT32_C(  1936649120), -INT32_C(   527662657), -INT32_C(  1340112381) } },
    { { -INT32_C(  1675721251),  INT32_C(   176007943), -INT32_C(  1816486867),  INT32_C(   165261056),  INT32_C(    21140223), -INT32_C(    96507940), -INT32_C(   462824343), -INT32_C(  1789473097),
         INT32_C(  1513190483),  INT32_C(  1298443807),  INT32_C(  1272979019), -INT32_C(   850085426),  INT32_C(   684627532),  INT32_C(  1713508093), -INT32_C(  1572172566), -INT32_C(  1388863398) },
      UINT16_C(26645),
      {  INT32_C(  1813459976),  INT32_C(  1636524673),  INT32_C(    35346861), -INT32_C(   191338714), -INT32_C(  1308453233),  INT32_C(  1195306492), -INT32_C(   957900657),  INT32_C(  1294924869),
        -INT32_C(  1296415439),  INT32_C(  1427391911), -INT32_C(  1000919138),  INT32_C(   632876950), -INT32_C(  2099790971),  INT32_C(   935925160), -INT32_C(   201477971), -INT32_C(   566219859) },
      {  INT32_C(  1813459976),  INT32_C(   176007943),  INT32_C(  1636524673),  INT32_C(   165261056),  INT32_C(    35346861), -INT32_C(    96507940), -INT32_C(   462824343), -INT32_C(  1789473097),
         INT32_C(  1513190483),  INT32_C(  1298443807),  INT32_C(  1272979019), -INT32_C(   191338714),  INT32_C(   684627532), -INT32_C(  1308453233),  INT32_C(  1195306492), -INT32_C(  1388863398) } },
    { {  INT32_C(   412154481), -INT32_C(   580017089),  INT32_C(  1772209363),  INT32_C(   965696180), -INT32_C(  1111792107),  INT32_C(   703890556), -INT32_C(   501419723), -INT32_C(  1916773092),
        -INT32_C(  1750708137), -INT32_C(   931916811), -INT32_C(  1942874408), -INT32_C(  2050637456), -INT32_C(  1555922649),  INT32_C(   986527237),  INT32_C(  1125968167), -INT32_C(  1630413754) },
      UINT16_C(30509),
      { -INT32_C(  1450565067),  INT32_C(   482304746), -INT32_C(  1260572690), -INT32_C(   164297292),  INT32_C(  1965832872), -INT32_C(  1856023691),  INT32_C(  1752081815),  INT32_C(  2027920195),
        -INT32_C(  1490916931), -INT32_C(  1161502260), -INT32_C(   982605551),  INT32_C(  1337762726),  INT32_C(  1405413598), -INT32_C(   740023492),  INT32_C(   205214409), -INT32_C(  1434117395) },
      { -INT32_C(  1450565067), -INT32_C(   580017089),  INT32_C(   482304746), -INT32_C(  1260572690), -INT32_C(  1111792107), -INT32_C(   164297292), -INT32_C(   501419723), -INT32_C(  1916773092),
         INT32_C(  1965832872), -INT32_C(  1856023691),  INT32_C(  1752081815), -INT32_C(  2050637456),  INT32_C(  2027920195), -INT32_C(  1490916931), -INT32_C(  1161502260), -INT32_C(  1630413754) } },
    { {  INT32_C(  1330816899), -INT32_C(  1727392120),  INT32_C(  1583315127), -INT32_C(    89318628),  INT32_C(  1062039811),  INT32_C(  1578250645),  INT32_C(  1902792068), -INT32_C(   350425241),
         INT32_C(   523923094),  INT32_C(  1001931908), -INT32_C(   644278339),  INT32_C(   919815730),  INT32_C(  1299521720), -INT32_C(   710178735),  INT32_C(  1028068821), -INT32_C(  1691852027) },
      UINT16_C(25297),
      {  INT32_C(  1940346298),  INT32_C(   713712784),  INT32_C(   275823933),  INT32_C(  1747986675),  INT32_C(   552632693), -INT32_C(  1640577449),  INT32_C(   721500931), -INT32_C(  1852976426),
        -INT32_C(  1224461273), -INT32_C(   706638184),  INT32_C(  1055216203), -INT32_C(   257485446), -INT32_C(   300902505),  INT32_C(  1619805789),  INT32_C(  1485540737), -INT32_C(  2031543969) },
      {  INT32_C(  1940346298), -INT32_C(  1727392120),  INT32_C(  1583315127), -INT32_C(    89318628),  INT32_C(   713712784),  INT32_C(  1578250645),  INT32_C(   275823933),  INT32_C(  1747986675),
         INT32_C(   523923094),  INT32_C(   552632693), -INT32_C(   644278339),  INT32_C(   919815730),  INT32_C(  1299521720), -INT32_C(  1640577449),  INT32_C(   721500931), -INT32_C(  1691852027) } },
    { { -INT32_C(   432149171), -INT32_C(   944038021), -INT32_C(   351952527),  INT32_C(  1306242230), -INT32_C(  1589908412), -INT32_C(  1274886350), -INT32_C(  1291023020), -INT32_C(   197528154),
         INT32_C(  1574598626),  INT32_C(   119838102), -INT32_C(   302896586),  INT32_C(   440061654), -INT32_C(   323193158), -INT32_C(  1834959299), -INT32_C(   230314933), -INT32_C(  2082046047) },
      UINT16_C(49398),
      {  INT32_C(    89492705), -INT32_C(  2060481389), -INT32_C(  1286404487), -INT32_C(   601289440), -INT32_C(  1701156870),  INT32_C(  1044899577), -INT32_C(  1094850344),  INT32_C(  1300149100),
        -INT32_C(   766323905), -INT32_C(   665288097), -INT32_C(  1467176056), -INT32_C(  1283082823),  INT32_C(   357375772), -INT32_C(   581659643), -INT32_C(   375713411),  INT32_C(    70654405) },
      { -INT32_C(   432149171),  INT32_C(    89492705), -INT32_C(  2060481389),  INT32_C(  1306242230), -INT32_C(  1286404487), -INT32_C(   601289440), -INT32_C(  1701156870),  INT32_C(  1044899577),
         INT32_C(  1574598626),  INT32_C(   119838102), -INT32_C(   302896586),  INT32_C(   440061654), -INT32_C(   323193158), -INT32_C(  1834959299), -INT32_C(  1094850344),  INT32_C(  1300149100) } },
    { {  INT32_C(  1289193709), -INT32_C(  1843056886), -INT32_C(  1824804390), -INT32_C(  2092515226), -INT32_C(   442985249), -INT32_C(  1513952216), -INT32_C(  1014079746),  INT32_C(  1690813559),
         INT32_C(  1471258189), -INT32_C(  1461004595), -INT32_C(   314890873), -INT32_C(   999259419),  INT32_C(  1051265302), -INT32_C(   203133707),  INT32_C(  1102475978), -INT32_C(  2069463497) },
      UINT16_C(22300),
      { -INT32_C(   986846501), -INT32_C(   840256366),  INT32_C(   307220385),  INT32_C(  1025205652), -INT32_C(  2002186076), -INT32_C(  1157991676),  INT32_C(  1530409397), -INT32_C(  1850583627),
        -INT32_C(   782835905),  INT32_C(   882786707), -INT32_C(  1538855408), -INT32_C(   136158893),  INT32_C(  1988070258), -INT32_C(  1271891201),  INT32_C(  1628400043), -INT32_C(    34422338) },
      {  INT32_C(  1289193709), -INT32_C(  1843056886), -INT32_C(   986846501), -INT32_C(   840256366),  INT32_C(   307220385), -INT32_C(  1513952216), -INT32_C(  1014079746),  INT32_C(  1690813559),
         INT32_C(  1025205652), -INT32_C(  2002186076), -INT32_C(  1157991676), -INT32_C(   999259419),  INT32_C(  1530409397), -INT32_C(   203133707), -INT32_C(  1850583627), -INT32_C(  2069463497) } },
    { {  INT32_C(   869157024), -INT32_C(  1704498039), -INT32_C(  1371623846), -INT32_C(  2119884785), -INT32_C(  1409866324),  INT32_C(  1247750303),  INT32_C(  1336635025), -INT32_C(   817062609),
         INT32_C(  1862408934), -INT32_C(   519476858),  INT32_C(   663701527),  INT32_C(   346567784), -INT32_C(   121659303),  INT32_C(  1497571016), -INT32_C(  1146556788),  INT32_C(  1921709196) },
      UINT16_C(35854),
      { -INT32_C(   336161567),  INT32_C(    70454645), -INT32_C(   583427276),  INT32_C(  1870500528), -INT32_C(   829536885),  INT32_C(  1186732702),  INT32_C(  1614432470), -INT32_C(  1662170950),
         INT32_C(  1384637404),  INT32_C(   626440944),  INT32_C(    84053845), -INT32_C(  1384808670),  INT32_C(  1652229060), -INT32_C(   207079651),  INT32_C(   978641536),  INT32_C(   114704682) },
      {  INT32_C(   869157024), -INT32_C(   336161567),  INT32_C(    70454645), -INT32_C(   583427276), -INT32_C(  1409866324),  INT32_C(  1247750303),  INT32_C(  1336635025), -INT32_C(   817062609),
         INT32_C(  1862408934), -INT32_C(   519476858),  INT32_C(  1870500528), -INT32_C(   829536885), -INT32_C(   121659303),  INT32_C(  1497571016), -INT32_C(  1146556788),  INT32_C(  1186732702) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    simde__m512i src = simde_mm512_loadu_epi32(test_vec[i].src);
    simde__m512i r = simde_mm512_mask_expandloadu_epi32(src, test_vec[i].k, HEDLEY_REINTERPRET_CAST(void const*, test_vec[i].mem_addr));
    simde_test_x86_assert_equal_i32x16(r, simde_mm512_loadu_epi32(test_vec[i].r));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    simde__m512i src = simde_test_x86_random_i32x16();
    simde__mmask16 k = simde_test_x86_random_mmask16();
    int32_t mem_addr[16];

    simde_test_codegen_random_memory(sizeof(mem_addr), HEDLEY_REINTERPRET_CAST(uint8_t*, mem_addr));

    simde__m512i r = simde_mm512_mask_expandloadu_epi32(src, k, HEDLEY_REINTERPRET_CAST(void const*, mem_addr));

    simde_test_x86_write_i32x16(2, src, SIMDE_TEST_VEC_POS_FIRST);
    simde_test_x86_write_mmask16(2, k, SIMDE_TEST_VEC_POS_MIDDLE);
    simde_test_codegen_write_vi32(2, sizeof(mem_addr) / sizeof(mem_addr[0]), mem_addr, SIMDE_TEST_VEC_POS_MIDDLE);
    simde_test_x86_write_i32x16(2, r, SIMDE_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

SIMDE_TEST_FUNC_LIST_BEGIN
  SIMDE_TEST_FUNC_LIST_ENTRY(mm512_mask_expandloadu_epi32)
SIMDE_TEST_FUNC_LIST_END

#include <test/x86/avx512/test-avx512-footer.h>
