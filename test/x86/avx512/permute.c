/* SPDX-License-Identifier: MIT
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use, copy,
 * modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
 * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 * Copyright:
 *   2024      Guation <guation@guation.cn>
 */

#define SIMDE_TEST_X86_AVX512_INSN permute

#include <test/x86/avx512/test-avx512.h>
#include <simde/x86/avx512/permute.h>

static int
test_simde_mm512_permute_ps(SIMDE_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const simde_float32 a[16];
    const simde_float32 r[16];
  } test_vec[8] = {
    { { SIMDE_FLOAT32_C(  -340.04), SIMDE_FLOAT32_C(   370.44), SIMDE_FLOAT32_C(  -231.71), SIMDE_FLOAT32_C(  -304.67),
        SIMDE_FLOAT32_C(  -818.31), SIMDE_FLOAT32_C(   298.76), SIMDE_FLOAT32_C(   -39.40), SIMDE_FLOAT32_C(    -2.68),
        SIMDE_FLOAT32_C(  -398.52), SIMDE_FLOAT32_C(   753.85), SIMDE_FLOAT32_C(  -344.62), SIMDE_FLOAT32_C(   -18.16),
        SIMDE_FLOAT32_C(   823.33), SIMDE_FLOAT32_C(  -829.79), SIMDE_FLOAT32_C(   606.41), SIMDE_FLOAT32_C(  -357.40) },
      { SIMDE_FLOAT32_C(  -340.04), SIMDE_FLOAT32_C(  -340.04), SIMDE_FLOAT32_C(  -340.04), SIMDE_FLOAT32_C(  -340.04),
        SIMDE_FLOAT32_C(  -818.31), SIMDE_FLOAT32_C(  -818.31), SIMDE_FLOAT32_C(  -818.31), SIMDE_FLOAT32_C(  -818.31),
        SIMDE_FLOAT32_C(  -398.52), SIMDE_FLOAT32_C(  -398.52), SIMDE_FLOAT32_C(  -398.52), SIMDE_FLOAT32_C(  -398.52),
        SIMDE_FLOAT32_C(   823.33), SIMDE_FLOAT32_C(   823.33), SIMDE_FLOAT32_C(   823.33), SIMDE_FLOAT32_C(   823.33) } },
    { { SIMDE_FLOAT32_C(   689.74), SIMDE_FLOAT32_C(   966.97), SIMDE_FLOAT32_C(   277.00), SIMDE_FLOAT32_C(  -981.09),
        SIMDE_FLOAT32_C(  -989.98), SIMDE_FLOAT32_C(  -367.45), SIMDE_FLOAT32_C(   639.85), SIMDE_FLOAT32_C(  -118.15),
        SIMDE_FLOAT32_C(   858.51), SIMDE_FLOAT32_C(  -103.66), SIMDE_FLOAT32_C(  -283.75), SIMDE_FLOAT32_C(   688.56),
        SIMDE_FLOAT32_C(  -585.32), SIMDE_FLOAT32_C(  -533.14), SIMDE_FLOAT32_C(  -182.91), SIMDE_FLOAT32_C(    74.63) },
      { SIMDE_FLOAT32_C(   966.97), SIMDE_FLOAT32_C(   689.74), SIMDE_FLOAT32_C(   689.74), SIMDE_FLOAT32_C(   689.74),
        SIMDE_FLOAT32_C(  -367.45), SIMDE_FLOAT32_C(  -989.98), SIMDE_FLOAT32_C(  -989.98), SIMDE_FLOAT32_C(  -989.98),
        SIMDE_FLOAT32_C(  -103.66), SIMDE_FLOAT32_C(   858.51), SIMDE_FLOAT32_C(   858.51), SIMDE_FLOAT32_C(   858.51),
        SIMDE_FLOAT32_C(  -533.14), SIMDE_FLOAT32_C(  -585.32), SIMDE_FLOAT32_C(  -585.32), SIMDE_FLOAT32_C(  -585.32) } },
    { { SIMDE_FLOAT32_C(   837.30), SIMDE_FLOAT32_C(   585.37), SIMDE_FLOAT32_C(   769.96), SIMDE_FLOAT32_C(  -981.00),
        SIMDE_FLOAT32_C(  -115.87), SIMDE_FLOAT32_C(  -269.44), SIMDE_FLOAT32_C(    16.32), SIMDE_FLOAT32_C(   485.61),
        SIMDE_FLOAT32_C(  -515.59), SIMDE_FLOAT32_C(   671.70), SIMDE_FLOAT32_C(  -532.55), SIMDE_FLOAT32_C(  -692.26),
        SIMDE_FLOAT32_C(   841.91), SIMDE_FLOAT32_C(  -926.13), SIMDE_FLOAT32_C(   -49.66), SIMDE_FLOAT32_C(   531.65) },
      { SIMDE_FLOAT32_C(   769.96), SIMDE_FLOAT32_C(   837.30), SIMDE_FLOAT32_C(   837.30), SIMDE_FLOAT32_C(   837.30),
        SIMDE_FLOAT32_C(    16.32), SIMDE_FLOAT32_C(  -115.87), SIMDE_FLOAT32_C(  -115.87), SIMDE_FLOAT32_C(  -115.87),
        SIMDE_FLOAT32_C(  -532.55), SIMDE_FLOAT32_C(  -515.59), SIMDE_FLOAT32_C(  -515.59), SIMDE_FLOAT32_C(  -515.59),
        SIMDE_FLOAT32_C(   -49.66), SIMDE_FLOAT32_C(   841.91), SIMDE_FLOAT32_C(   841.91), SIMDE_FLOAT32_C(   841.91) } },
    { { SIMDE_FLOAT32_C(  -959.17), SIMDE_FLOAT32_C(  -772.66), SIMDE_FLOAT32_C(   550.56), SIMDE_FLOAT32_C(  -949.15),
        SIMDE_FLOAT32_C(  -140.11), SIMDE_FLOAT32_C(   190.41), SIMDE_FLOAT32_C(   -67.30), SIMDE_FLOAT32_C(  -281.60),
        SIMDE_FLOAT32_C(  -913.25), SIMDE_FLOAT32_C(   648.96), SIMDE_FLOAT32_C(  -593.04), SIMDE_FLOAT32_C(  -498.58),
        SIMDE_FLOAT32_C(  -884.18), SIMDE_FLOAT32_C(   224.05), SIMDE_FLOAT32_C(   576.06), SIMDE_FLOAT32_C(   953.12) },
      { SIMDE_FLOAT32_C(  -949.15), SIMDE_FLOAT32_C(  -959.17), SIMDE_FLOAT32_C(  -959.17), SIMDE_FLOAT32_C(  -959.17),
        SIMDE_FLOAT32_C(  -281.60), SIMDE_FLOAT32_C(  -140.11), SIMDE_FLOAT32_C(  -140.11), SIMDE_FLOAT32_C(  -140.11),
        SIMDE_FLOAT32_C(  -498.58), SIMDE_FLOAT32_C(  -913.25), SIMDE_FLOAT32_C(  -913.25), SIMDE_FLOAT32_C(  -913.25),
        SIMDE_FLOAT32_C(   953.12), SIMDE_FLOAT32_C(  -884.18), SIMDE_FLOAT32_C(  -884.18), SIMDE_FLOAT32_C(  -884.18) } },
    { { SIMDE_FLOAT32_C(  -190.58), SIMDE_FLOAT32_C(   346.02), SIMDE_FLOAT32_C(   972.12), SIMDE_FLOAT32_C(   693.55),
        SIMDE_FLOAT32_C(  -923.42), SIMDE_FLOAT32_C(   -11.56), SIMDE_FLOAT32_C(   179.16), SIMDE_FLOAT32_C(  -439.01),
        SIMDE_FLOAT32_C(  -339.86), SIMDE_FLOAT32_C(   646.61), SIMDE_FLOAT32_C(  -131.27), SIMDE_FLOAT32_C(  -497.94),
        SIMDE_FLOAT32_C(   720.48), SIMDE_FLOAT32_C(   819.07), SIMDE_FLOAT32_C(  -966.29), SIMDE_FLOAT32_C(   761.31) },
      { SIMDE_FLOAT32_C(  -190.58), SIMDE_FLOAT32_C(   346.02), SIMDE_FLOAT32_C(  -190.58), SIMDE_FLOAT32_C(  -190.58),
        SIMDE_FLOAT32_C(  -923.42), SIMDE_FLOAT32_C(   -11.56), SIMDE_FLOAT32_C(  -923.42), SIMDE_FLOAT32_C(  -923.42),
        SIMDE_FLOAT32_C(  -339.86), SIMDE_FLOAT32_C(   646.61), SIMDE_FLOAT32_C(  -339.86), SIMDE_FLOAT32_C(  -339.86),
        SIMDE_FLOAT32_C(   720.48), SIMDE_FLOAT32_C(   819.07), SIMDE_FLOAT32_C(   720.48), SIMDE_FLOAT32_C(   720.48) } },
    { { SIMDE_FLOAT32_C(  -953.59), SIMDE_FLOAT32_C(   584.26), SIMDE_FLOAT32_C(   812.16), SIMDE_FLOAT32_C(   -93.70),
        SIMDE_FLOAT32_C(  -225.33), SIMDE_FLOAT32_C(  -255.13), SIMDE_FLOAT32_C(   624.70), SIMDE_FLOAT32_C(  -138.58),
        SIMDE_FLOAT32_C(  -606.18), SIMDE_FLOAT32_C(  -968.34), SIMDE_FLOAT32_C(   362.85), SIMDE_FLOAT32_C(  -490.35),
        SIMDE_FLOAT32_C(   255.71), SIMDE_FLOAT32_C(   -61.10), SIMDE_FLOAT32_C(  -537.23), SIMDE_FLOAT32_C(  -934.87) },
      { SIMDE_FLOAT32_C(   584.26), SIMDE_FLOAT32_C(   584.26), SIMDE_FLOAT32_C(  -953.59), SIMDE_FLOAT32_C(  -953.59),
        SIMDE_FLOAT32_C(  -255.13), SIMDE_FLOAT32_C(  -255.13), SIMDE_FLOAT32_C(  -225.33), SIMDE_FLOAT32_C(  -225.33),
        SIMDE_FLOAT32_C(  -968.34), SIMDE_FLOAT32_C(  -968.34), SIMDE_FLOAT32_C(  -606.18), SIMDE_FLOAT32_C(  -606.18),
        SIMDE_FLOAT32_C(   -61.10), SIMDE_FLOAT32_C(   -61.10), SIMDE_FLOAT32_C(   255.71), SIMDE_FLOAT32_C(   255.71) } },
    { { SIMDE_FLOAT32_C(  -715.08), SIMDE_FLOAT32_C(  -565.11), SIMDE_FLOAT32_C(   758.69), SIMDE_FLOAT32_C(  -638.50),
        SIMDE_FLOAT32_C(   423.33), SIMDE_FLOAT32_C(   -62.15), SIMDE_FLOAT32_C(   -77.51), SIMDE_FLOAT32_C(  -916.53),
        SIMDE_FLOAT32_C(  -415.54), SIMDE_FLOAT32_C(   791.21), SIMDE_FLOAT32_C(  -414.47), SIMDE_FLOAT32_C(  -695.06),
        SIMDE_FLOAT32_C(   610.28), SIMDE_FLOAT32_C(  -380.76), SIMDE_FLOAT32_C(  -933.75), SIMDE_FLOAT32_C(   656.69) },
      { SIMDE_FLOAT32_C(   758.69), SIMDE_FLOAT32_C(  -565.11), SIMDE_FLOAT32_C(  -715.08), SIMDE_FLOAT32_C(  -715.08),
        SIMDE_FLOAT32_C(   -77.51), SIMDE_FLOAT32_C(   -62.15), SIMDE_FLOAT32_C(   423.33), SIMDE_FLOAT32_C(   423.33),
        SIMDE_FLOAT32_C(  -414.47), SIMDE_FLOAT32_C(   791.21), SIMDE_FLOAT32_C(  -415.54), SIMDE_FLOAT32_C(  -415.54),
        SIMDE_FLOAT32_C(  -933.75), SIMDE_FLOAT32_C(  -380.76), SIMDE_FLOAT32_C(   610.28), SIMDE_FLOAT32_C(   610.28) } },
    { { SIMDE_FLOAT32_C(  -796.50), SIMDE_FLOAT32_C(   878.41), SIMDE_FLOAT32_C(  -437.01), SIMDE_FLOAT32_C(   -21.83),
        SIMDE_FLOAT32_C(  -376.72), SIMDE_FLOAT32_C(  -812.31), SIMDE_FLOAT32_C(   839.60), SIMDE_FLOAT32_C(    17.10),
        SIMDE_FLOAT32_C(  -780.65), SIMDE_FLOAT32_C(   202.44), SIMDE_FLOAT32_C(   526.75), SIMDE_FLOAT32_C(   475.06),
        SIMDE_FLOAT32_C(  -858.66), SIMDE_FLOAT32_C(   989.52), SIMDE_FLOAT32_C(   540.19), SIMDE_FLOAT32_C(  -573.73) },
      { SIMDE_FLOAT32_C(   -21.83), SIMDE_FLOAT32_C(   878.41), SIMDE_FLOAT32_C(  -796.50), SIMDE_FLOAT32_C(  -796.50),
        SIMDE_FLOAT32_C(    17.10), SIMDE_FLOAT32_C(  -812.31), SIMDE_FLOAT32_C(  -376.72), SIMDE_FLOAT32_C(  -376.72),
        SIMDE_FLOAT32_C(   475.06), SIMDE_FLOAT32_C(   202.44), SIMDE_FLOAT32_C(  -780.65), SIMDE_FLOAT32_C(  -780.65),
        SIMDE_FLOAT32_C(  -573.73), SIMDE_FLOAT32_C(   989.52), SIMDE_FLOAT32_C(  -858.66), SIMDE_FLOAT32_C(  -858.66) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    simde__m512 a = simde_mm512_loadu_ps(test_vec[i].a);
    simde__m512 r;

    SIMDE_CONSTIFY_8_(simde_mm512_permute_ps, r, (HEDLEY_UNREACHABLE(), a), i & 7, a);

    simde_test_x86_assert_equal_f32x16(r, simde_mm512_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    simde__m512 a = simde_test_x86_random_f32x16(SIMDE_FLOAT32_C(-1000.0), SIMDE_FLOAT32_C(1000.0));
    simde__m512 r;

    SIMDE_CONSTIFY_8_(simde_mm512_permute_ps, r, (HEDLEY_UNREACHABLE(), a), i & 7, a);

    simde_test_x86_write_f32x16(2, a, SIMDE_TEST_VEC_POS_FIRST);
    simde_test_x86_write_f32x16(2, r, SIMDE_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

SIMDE_TEST_FUNC_LIST_BEGIN
  SIMDE_TEST_FUNC_LIST_ENTRY(mm512_permute_ps)
SIMDE_TEST_FUNC_LIST_END

#include <test/x86/avx512/test-avx512-footer.h>
